<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 2.0.0 from src/site/markdown/usage.md at 2025-06-30
 | Rendered using Apache Maven Fluido Skin 2.1.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 2.0.0" />
    <title>Usage â€“ rpm-builder-maven-plugin</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-2.1.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-2.1.0.min.js"></script>
    <style>.github-fork-ribbon:before { background-color: gray; }</style>
  </head>
  <body class="topBarEnabled">
    <a class="github-fork-ribbon right-top" href="https://github.com/project-ncl/rpm-builder-maven-plugin" data-ribbon="Fork me on GitHub">Fork me on GitHub</a>
    <header id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
        <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
            <ul class="nav">
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Overview <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="index.html">Introduction</a></li>
            <li><a href="plugin-info.html">Goals</a></li>
            <li><a>Usage</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Project Documentation <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li class="dropdown-submenu">
<a href="project-info.html">Project Information</a>
              <ul class="dropdown-menu">
                  <li><a href="summary.html">Summary</a></li>
                  <li><a href="scm.html">Source Code Management</a></li>
                  <li><a href="issue-management.html">Issue Management</a></li>
                  <li><a href="licenses.html">Licenses</a></li>
                  <li><a href="plugins.html">Plugins</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="project-reports.html">Project Reports</a>
              <ul class="dropdown-menu">
                  <li><a href="plugin-info.html">Plugin Documentation</a></li>
              </ul>
            </li>
        </ul>
      </li>
            </ul>
        </div>
      </div>
    </header>
    <div class="container-fluid container-fluid-top">
      <header>
        <div id="banner">
          <div class="pull-left"><div id="bannerLeft"><h1>RPM Builder Maven Plugin</h1></div></div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2025-06-30<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.3-SNAPSHOT</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Overview</li>
    <li><a href="index.html">Introduction</a></li>
    <li><a href="plugin-info.html">Goals</a></li>
    <li class="active"><a>Usage</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="project-reports.html"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
<a href="https://maven.apache.org/" class="builtBy" target="_blank"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn" class="span10">
<section><a id="Usage"></a>
<h1>Usage</h1>
<p>The plugin has a number of configuration parameters that are described on the <a href="plugin-info.html">goals</a> page. It requires the <code>rpmbuild</code> binary to be installed in the host system. It should be run in a directory containing a spec file which will be automatically located.</p>
<p><strong>Note:</strong> when using this plugin the packaging should be set to spec. It will attach the spec file (that may have been modified by the patching mechanism) to the build as the primary artifact. It will run <code>rpmbuild -ba</code> on the spec file.</p>
<p><strong>Note:</strong> the prior build to be wrapped should have its version embedded in the properties under the property <code>wrappedBuild</code>. This is mandatory if using changelog generation.</p><section><a id="Patching_via_Groovy"></a>
<h2>Patching via Groovy</h2>
<p>The plugin can run a groovy script (<code>groovyScript</code>) to perform patches to a RPM spec file before building e.g. if PME has been run on the containing pom then this could be used to update template fields within the spec file. For the groovy scripts, the following variables are injected:</p>
<ul>

<li><code>meadalpha</code> the final portion of the <code>wrappedBuild</code> property converted to RPM NVR compatible format e.g. <code>.SP13_redhat_00001</code> from the example below.</li>
<li><code>meadrel</code> with the value <code>.1</code></li>
<li><code>meadversion</code> the numeric value of the <code>wrappedBuild</code> property e.g. <code>1.4.18</code> from the example below.</li>
<li><code>serial</code> - the final part of the increment of the project version e.g. <code>2</code> from the example below.</li>
<li><code>wrappedBuild</code> the value of the <code>wrappedBuild</code> property</li>
</ul></section><section><a id="Miscellaneous"></a>
<h2>Miscellaneous</h2>
<p>The rpms can be packaged into a zip and attached to the build. This is disabled by default and may be enabled via <code>attachZip</code>
A <code>macros</code> configuration map may be used to pass additional macro defines to the <code>rpmbuild</code> command.
A <code>changeLog</code> configuration object may be used to trigger change log generation. By default, email is set to <code>project-ncl@redhat.com</code> and message is set to <code>- New Release</code>.</p></section><section><a id="Deployment"></a>
<h2>Deployment</h2>
<p>The plugin can deploy the RPMs to a repository. This is controlled by <code>rpmDeploymentRepository</code> which supports the same format as <code>altDeploymentRepository</code>. The plugin deployment may be skipped with <code>rpm.deploy.skip</code></p></section><section><a id="Examples"></a>
<h2>Examples</h2>

<pre class="prettyprint"><code class="language-xml">    &lt;artifactId&gt;my-build&lt;/artifactId&gt;
    &lt;version&gt;1.0.0.redhat-00002&lt;/version&gt;
    &lt;packaging&gt;spec&lt;/packaging&gt;

    &lt;properties&gt;
      &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
      &lt;wrappedBuild&gt;1.4.18.SP13-redhat-00003&lt;/wrappedBuild&gt;
    &lt;/properties&gt;

    &lt;!-- ... --&gt;

    &lt;plugin&gt;
        &lt;groupId&gt;org.jboss.pnc&lt;/groupId&gt;
        &lt;artifactId&gt;rpm-builder-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.0&lt;/version&gt;
        &lt;extensions&gt;true&lt;/extensions&gt;
        &lt;configuration&gt;
          &lt;macros&gt;
              &lt;dist&gt;.el9eap8&lt;/dist&gt;
          &lt;/macros&gt;
          &lt;changeLog&gt;
              &lt;generate&gt;true&lt;/generate&gt;
              &lt;email&gt;me@dummy.com&lt;/email&gt;
          &lt;/changeLog&gt;
          &lt;groovyPatch&gt;
            def serial = (&quot;${project.version}&quot; =~ &quot;(.*redhat-0+)(.*)&quot;)[0][2]
            def original_version = &quot;${wrappedBuild}&quot;.replaceAll(&quot;.redhat.*&quot;, &quot;&quot;)
            def rh_version = &quot;${wrappedBuild}&quot;.replaceAll(original_version, &quot;&quot;)
            def rpm_version = &quot;${wrappedBuild}&quot;.replaceAll(original_version, &quot;&quot;).replaceAll(&quot;-&quot;, &quot;_&quot;)

            println &quot;I am building version ${project.version} of ${project.name} with ${wrappedBuild} at ${new Date\(\)}&quot;
            println &quot;Serial ${serial} OrigVersion ${original_version} RHVersion ${rh_version}&quot;

            // Note the spec file is always copied to target/spec first so modify it there.
            def spec = new File(&quot;${project.build.directory}/spec/apache-sshd.spec&quot;)
            def contents = spec.getText('UTF-8')

            // Hack to ensure subdirectory creation is correctly named.
            contents = contents.replaceAll(&quot;%setup -q -n wrappedBuild-&quot;, &quot;%setup -q -n apache-sshd-&quot;)

            contents = &quot;&quot;&quot;
%global meadversion ${original_version}
%global namedversion ${wrappedBuild}
%global meadalpha ${rpm_version}
%global meadrel .1
%global serial $serial
%define maven_version ${wrappedBuild}
%if %with mead
Source100: sshd-${wrappedBuild}-project-sources.zip
%endif

&quot;&quot;&quot; + contents
            spec.write(contents)
          &lt;/groovyPatch&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;

</code></pre>
<p>Alternate example using the injected variables in the groovy script:</p>

<pre class="prettyprint"><code class="language-xml">    &lt;plugin&gt;
        &lt;groupId&gt;org.jboss.pnc&lt;/groupId&gt;
        &lt;artifactId&gt;rpm-builder-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.0&lt;/version&gt;
        &lt;extensions&gt;true&lt;/extensions&gt;
        &lt;configuration&gt;
          &lt;macros&gt;
              &lt;dist&gt;.el9eap8&lt;/dist&gt;
          &lt;/macros&gt;
          &lt;changeLog&gt;
              &lt;generate&gt;true&lt;/generate&gt;
              &lt;email&gt;me@dummy.com&lt;/email&gt;
          &lt;/changeLog&gt;
          &lt;groovyPatch&gt;
            // Note the spec file is always copied to target/spec first so modify it there.
            def spec = new File(&quot;${project.build.directory}/spec/apache-sshd.spec&quot;)
            def contents = spec.getText('UTF-8')

            contents = &quot;&quot;&quot;
%global meadversion ${meadversion}
%global meadalpha ${meadalpha}
%global meadrel ${meadrel}
%global serial ${serial}
%define maven_version ${wrappedBuild}

%if %with mead
Source100: sshd-${wrappedBuild}-project-sources.zip
%endif
&quot;&quot;&quot; + contents
                spec.write(contents)
          &lt;/groovyPatch&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;

</code></pre></section></section>        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Â©      2025
<a href="http://www.jboss.org">JBoss by Red Hat</a>
</p>
        </div>
      </div>
    </footer>
  </body>
</html>